{
  "foreign_key_relationships": [
    {
      "foreign_table": "auth.identities",
      "primary_table": "auth.users", 
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "identities_user_id_fkey",
      "description": "ربط هويات المستخدمين بحساباتهم الأساسية"
    },
    {
      "foreign_table": "auth.mfa_amr_claims",
      "primary_table": "auth.sessions",
      "fk_columns": "session_id", 
      "referenced_columns": "id",
      "constraint_name": "mfa_amr_claims_session_id_fkey",
      "description": "ربط ادعاءات المصادقة متعددة العوامل بالجلسات"
    },
    {
      "foreign_table": "auth.mfa_challenges",
      "primary_table": "auth.mfa_factors",
      "fk_columns": "factor_id",
      "referenced_columns": "id", 
      "constraint_name": "mfa_challenges_auth_factor_id_fkey",
      "description": "ربط تحديات المصادقة بعوامل المصادقة"
    },
    {
      "foreign_table": "auth.mfa_factors",
      "primary_table": "auth.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "mfa_factors_user_id_fkey", 
      "description": "ربط عوامل المصادقة متعددة العوامل بالمستخدمين"
    },
    {
      "foreign_table": "auth.one_time_tokens",
      "primary_table": "auth.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "one_time_tokens_user_id_fkey",
      "description": "ربط الرموز المؤقتة بالمستخدمين"
    },
    {
      "foreign_table": "auth.refresh_tokens",
      "primary_table": "auth.sessions", 
      "fk_columns": "session_id",
      "referenced_columns": "id",
      "constraint_name": "refresh_tokens_session_id_fkey",
      "description": "ربط رموز التحديث بالجلسات"
    },
    {
      "foreign_table": "auth.saml_providers",
      "primary_table": "auth.sso_providers",
      "fk_columns": "sso_provider_id",
      "referenced_columns": "id",
      "constraint_name": "saml_providers_sso_provider_id_fkey",
      "description": "ربط موفري SAML بموفري SSO"
    },
    {
      "foreign_table": "auth.saml_relay_states",
      "primary_table": "auth.flow_state",
      "fk_columns": "flow_state_id",
      "referenced_columns": "id", 
      "constraint_name": "saml_relay_states_flow_state_id_fkey",
      "description": "ربط حالات SAML بحالة التدفق"
    },
    {
      "foreign_table": "auth.sessions",
      "primary_table": "auth.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "sessions_user_id_fkey",
      "description": "ربط الجلسات بالمستخدمين"
    },
    {
      "foreign_table": "public.ai_system_recommendations",
      "primary_table": "auth.users",
      "fk_columns": "executed_by",
      "referenced_columns": "id",
      "constraint_name": "ai_system_recommendations_executed_by_fkey",
      "description": "ربط توصيات النظام الذكي بالمستخدمين المنفذين"
    },
    {
      "foreign_table": "public.auth_audit_log",
      "primary_table": "public.users",
      "fk_columns": "user_id", 
      "referenced_columns": "id",
      "constraint_name": "auth_audit_log_user_id_fkey",
      "description": "ربط سجل التدقيق بالمستخدمين"
    },
    {
      "foreign_table": "public.auth_role_permissions",
      "primary_table": "public.auth_permissions",
      "fk_columns": "permission_id",
      "referenced_columns": "id",
      "constraint_name": "auth_role_permissions_permission_id_fkey",
      "description": "ربط الأدوار بالصلاحيات"
    },
    {
      "foreign_table": "public.auth_role_permissions", 
      "primary_table": "public.auth_roles",
      "fk_columns": "role_id",
      "referenced_columns": "id",
      "constraint_name": "auth_role_permissions_role_id_fkey",
      "description": "ربط الصلاحيات بالأدوار"
    },
    {
      "foreign_table": "public.auth_user_permissions",
      "primary_table": "public.auth_permissions",
      "fk_columns": "permission_id",
      "referenced_columns": "id",
      "constraint_name": "auth_user_permissions_permission_id_fkey",
      "description": "ربط المستخدمين بالصلاحيات المباشرة"
    },
    {
      "foreign_table": "public.auth_user_permissions",
      "primary_table": "public.users",
      "fk_columns": "assigned_by",
      "referenced_columns": "id", 
      "constraint_name": "auth_user_permissions_assigned_by_fkey",
      "description": "تتبع من قام بإسناد الصلاحيات"
    },
    {
      "foreign_table": "public.auth_user_permissions",
      "primary_table": "public.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "auth_user_permissions_user_id_fkey",
      "description": "ربط الصلاحيات بالمستخدمين"
    },
    {
      "foreign_table": "public.auth_user_roles",
      "primary_table": "public.auth_roles",
      "fk_columns": "role_id",
      "referenced_columns": "id",
      "constraint_name": "auth_user_roles_role_id_fkey",
      "description": "ربط المستخدمين بأدوارهم"
    },
    {
      "foreign_table": "public.auth_user_roles",
      "primary_table": "public.users",
      "fk_columns": "assigned_by",
      "referenced_columns": "id",
      "constraint_name": "auth_user_roles_assigned_by_fkey", 
      "description": "تتبع من قام بإسناد الأدوار"
    },
    {
      "foreign_table": "public.auth_user_security_settings",
      "primary_table": "public.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "auth_user_security_settings_user_id_fkey",
      "description": "ربط إعدادات الأمان بالمستخدمين"
    },
    {
      "foreign_table": "public.auth_user_sessions",
      "primary_table": "public.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "auth_user_sessions_user_id_fkey",
      "description": "ربط جلسات المستخدمين بحساباتهم"
    },
    {
      "foreign_table": "public.auth_verification_codes",
      "primary_table": "public.users",
      "fk_columns": "user_id",
      "referenced_columns": "id",
      "constraint_name": "auth_verification_codes_user_id_fkey",
      "description": "ربط رموز التحقق بالمستخدمين"
    },
    {
      "foreign_table": "public.daily_expense_summaries",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "daily_expense_summaries_project_id_fkey",
      "description": "ربط ملخصات المصروفات بالمشاريع"
    },
    {
      "foreign_table": "public.equipment",
      "primary_table": "public.projects",
      "fk_columns": "current_project_id",
      "referenced_columns": "id",
      "constraint_name": "equipment_current_project_id_fkey",
      "description": "ربط المعدات بمشاريعها الحالية"
    },
    {
      "foreign_table": "public.equipment_movements",
      "primary_table": "public.equipment", 
      "fk_columns": "equipment_id",
      "referenced_columns": "id",
      "constraint_name": "equipment_movements_equipment_id_fkey",
      "description": "ربط حركة المعدات بالمعدات نفسها"
    },
    {
      "foreign_table": "public.fund_transfers",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "fund_transfers_project_id_fkey",
      "description": "ربط تحويلات الأموال بالمشاريع"
    },
    {
      "foreign_table": "public.material_purchases",
      "primary_table": "public.materials",
      "fk_columns": "material_id",
      "referenced_columns": "id",
      "constraint_name": "material_purchases_material_id_fkey",
      "description": "ربط مشتريات المواد بفهرس المواد"
    },
    {
      "foreign_table": "public.material_purchases",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "material_purchases_project_id_fkey",
      "description": "ربط مشتريات المواد بالمشاريع"
    },
    {
      "foreign_table": "public.messages",
      "primary_table": "public.channels",
      "fk_columns": "channel_id",
      "referenced_columns": "id",
      "constraint_name": "messages_channel_id_fkey",
      "description": "ربط الرسائل بقنوات التواصل"
    },
    {
      "foreign_table": "public.notification_queue",
      "primary_table": "public.notifications",
      "fk_columns": "notification_id",
      "referenced_columns": "id",
      "constraint_name": "notification_queue_notification_id_fkey",
      "description": "ربط طابور الإشعارات بالإشعارات الأساسية"
    },
    {
      "foreign_table": "public.project_fund_transfers",
      "primary_table": "public.projects",
      "fk_columns": "from_project_id",
      "referenced_columns": "id",
      "constraint_name": "project_fund_transfers_from_project_id_fkey",
      "description": "ربط تحويلات الأموال بالمشروع المصدر"
    },
    {
      "foreign_table": "public.project_fund_transfers",
      "primary_table": "public.projects", 
      "fk_columns": "to_project_id",
      "referenced_columns": "id",
      "constraint_name": "project_fund_transfers_to_project_id_fkey",
      "description": "ربط تحويلات الأموال بالمشروع المستلم"
    },
    {
      "foreign_table": "public.supplier_payments",
      "primary_table": "public.material_purchases",
      "fk_columns": "purchase_id",
      "referenced_columns": "id",
      "constraint_name": "supplier_payments_purchase_id_fkey",
      "description": "ربط مدفوعات الموردين بالمشتريات"
    },
    {
      "foreign_table": "public.supplier_payments",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "supplier_payments_project_id_fkey",
      "description": "ربط مدفوعات الموردين بالمشاريع"
    },
    {
      "foreign_table": "public.transportation_expenses",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "transportation_expenses_project_id_fkey",
      "description": "ربط مصاريف المواصلات بالمشاريع"
    },
    {
      "foreign_table": "public.transportation_expenses", 
      "primary_table": "public.workers",
      "fk_columns": "worker_id",
      "referenced_columns": "id",
      "constraint_name": "transportation_expenses_worker_id_fkey",
      "description": "ربط مصاريف المواصلات بالعمال"
    },
    {
      "foreign_table": "public.worker_attendance",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "worker_attendance_project_id_fkey",
      "description": "ربط حضور العمال بالمشاريع"
    },
    {
      "foreign_table": "public.worker_attendance",
      "primary_table": "public.workers",
      "fk_columns": "worker_id",
      "referenced_columns": "id",
      "constraint_name": "worker_attendance_worker_id_fkey",
      "description": "ربط حضور العمال بسجلات العمال"
    },
    {
      "foreign_table": "public.worker_balances",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "worker_balances_project_id_fkey",
      "description": "ربط أرصدة العمال بالمشاريع"
    },
    {
      "foreign_table": "public.worker_balances",
      "primary_table": "public.workers",
      "fk_columns": "worker_id",
      "referenced_columns": "id",
      "constraint_name": "worker_balances_worker_id_fkey",
      "description": "ربط أرصدة العمال بسجلات العمال"
    },
    {
      "foreign_table": "public.worker_misc_expenses",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id", 
      "constraint_name": "worker_misc_expenses_project_id_fkey",
      "description": "ربط نثريات العمال بالمشاريع"
    },
    {
      "foreign_table": "public.worker_transfers",
      "primary_table": "public.projects",
      "fk_columns": "project_id",
      "referenced_columns": "id",
      "constraint_name": "worker_transfers_project_id_fkey",
      "description": "ربط حوالات العمال بالمشاريع"
    },
    {
      "foreign_table": "public.worker_transfers",
      "primary_table": "public.workers",
      "fk_columns": "worker_id",
      "referenced_columns": "id",
      "constraint_name": "worker_transfers_worker_id_fkey",
      "description": "ربط حوالات العمال بسجلات العمال"
    },
    {
      "foreign_table": "storage.objects",
      "primary_table": "storage.buckets",
      "fk_columns": "bucket_id",
      "referenced_columns": "id", 
      "constraint_name": "objects_bucketId_fkey",
      "description": "ربط كائنات التخزين بحاويات التخزين"
    },
    {
      "foreign_table": "storage.s3_multipart_uploads",
      "primary_table": "storage.buckets",
      "fk_columns": "bucket_id",
      "referenced_columns": "id",
      "constraint_name": "s3_multipart_uploads_bucket_id_fkey",
      "description": "ربط تحميل الملفات متعددة الأجزاء بالحاويات"
    },
    {
      "foreign_table": "storage.s3_multipart_uploads_parts",
      "primary_table": "storage.buckets",
      "fk_columns": "bucket_id",
      "referenced_columns": "id",
      "constraint_name": "s3_multipart_uploads_parts_bucket_id_fkey",
      "description": "ربط أجزاء الملفات بالحاويات"
    },
    {
      "foreign_table": "storage.s3_multipart_uploads_parts",
      "primary_table": "storage.s3_multipart_uploads",
      "fk_columns": "upload_id", 
      "referenced_columns": "id",
      "constraint_name": "s3_multipart_uploads_parts_upload_id_fkey",
      "description": "ربط أجزاء الملفات بعمليات التحميل"
    }
  ],
  
  "relationship_analysis": {
    "total_foreign_keys": 24,
    "auth_schema_relationships": 8,
    "public_schema_relationships": 14,
    "storage_schema_relationships": 2,
    
    "critical_relationships": [
      {
        "type": "One-to-Many",
        "relationship": "projects → worker_attendance",
        "importance": "Critical for tracking worker presence per project"
      },
      {
        "type": "One-to-Many", 
        "relationship": "users → notifications",
        "importance": "Essential for notification system functionality"
      },
      {
        "type": "Many-to-Many",
        "relationship": "users ↔ auth_roles (via auth_user_roles)",
        "importance": "Core security and permission system"
      },
      {
        "type": "One-to-Many",
        "relationship": "projects → material_purchases",
        "importance": "Financial tracking and project cost management"
      }
    ],
    
    "data_integrity_constraints": [
      "CASCADE DELETE: When project deleted, related attendance records deleted",
      "CASCADE DELETE: When user deleted, related sessions and tokens deleted", 
      "RESTRICT: Cannot delete material if purchases exist",
      "RESTRICT: Cannot delete worker if attendance records exist"
    ]
  }
}