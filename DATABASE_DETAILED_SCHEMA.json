{
  "database_info": {
    "name": "Construction Management System Database",
    "version": "PostgreSQL 15+",
    "provider": "Supabase",
    "total_tables": 69,
    "schemas": {
      "public": {
        "description": "Main application tables",
        "table_count": 46
      },
      "auth": {
        "description": "Supabase authentication system",
        "table_count": 17
      },
      "storage": {
        "description": "File storage system",
        "table_count": 4
      },
      "extensions": {
        "description": "Database extensions",
        "table_count": 2
      }
    },
    "last_updated": "August 30, 2025"
  },
  
  "core_system_tables": {
    "project_management": [
      {
        "table": "projects",
        "purpose": "Core project data and management",
        "key_columns": ["id", "name", "status", "budget", "created_at"]
      },
      {
        "table": "users", 
        "purpose": "System users and administrators",
        "key_columns": ["id", "username", "email", "role", "created_at"]
      },
      {
        "table": "fund_transfers",
        "purpose": "Project fund transfers and budget management",
        "key_columns": ["id", "project_id", "amount", "transfer_date", "description"]
      },
      {
        "table": "project_fund_transfers",
        "purpose": "Inter-project fund transfers",
        "key_columns": ["id", "from_project_id", "to_project_id", "amount", "transfer_date"]
      }
    ],
    
    "worker_management": [
      {
        "table": "workers",
        "purpose": "Worker information and profiles",
        "key_columns": ["id", "name", "type", "daily_wage", "created_at"]
      },
      {
        "table": "worker_attendance",
        "purpose": "Daily worker attendance tracking",
        "key_columns": ["id", "worker_id", "project_id", "date", "present", "wage_amount"]
      },
      {
        "table": "worker_transfers",
        "purpose": "Family remittances and transfers",
        "key_columns": ["id", "worker_id", "project_id", "amount", "transfer_date", "recipient"]
      },
      {
        "table": "worker_balances",
        "purpose": "Worker account balances",
        "key_columns": ["id", "worker_id", "project_id", "balance", "last_updated"]
      }
    ],
    
    "material_management": [
      {
        "table": "materials",
        "purpose": "Construction materials catalog",
        "key_columns": ["id", "name", "unit", "category", "created_at"]
      },
      {
        "table": "material_purchases",
        "purpose": "Material purchase records",
        "key_columns": ["id", "project_id", "material_id", "quantity", "unit_price", "total_amount", "purchase_date"]
      },
      {
        "table": "suppliers",
        "purpose": "Supplier information and accounts",
        "key_columns": ["id", "name", "contact_info", "account_balance", "created_at"]
      },
      {
        "table": "supplier_payments",
        "purpose": "Payments to suppliers",
        "key_columns": ["id", "project_id", "purchase_id", "amount", "payment_date"]
      }
    ],
    
    "notification_system": [
      {
        "table": "notifications",
        "purpose": "Core notification system",
        "key_columns": ["id", "title_ar", "content_ar", "type", "priority", "recipients", "created_by", "created_at"]
      },
      {
        "table": "notification_templates",
        "purpose": "Notification templates for automation",
        "key_columns": ["id", "name", "type", "title_template", "content_template", "created_at"]
      },
      {
        "table": "notification_settings",
        "purpose": "User notification preferences",
        "key_columns": ["id", "user_id", "notification_types", "is_enabled", "created_at"]
      },
      {
        "table": "notification_queue",
        "purpose": "Notification delivery queue",
        "key_columns": ["id", "notification_id", "status", "delivery_method", "scheduled_at"]
      },
      {
        "table": "notification_read_states",
        "purpose": "Tracking read status per user",
        "key_columns": ["id", "user_id", "notification_id", "is_read", "read_at"]
      },
      {
        "table": "channels",
        "purpose": "Communication channels",
        "key_columns": ["id", "name", "type", "created_at"]
      }
    ],
    
    "security_system": [
      {
        "table": "auth_roles",
        "purpose": "User roles and permissions",
        "key_columns": ["id", "name", "description", "permissions", "created_at"]
      },
      {
        "table": "auth_permissions",
        "purpose": "Detailed permissions system",
        "key_columns": ["id", "name", "resource", "action", "description"]
      },
      {
        "table": "auth_user_sessions",
        "purpose": "User session management",
        "key_columns": ["id", "user_id", "session_token", "device_info", "expires_at"]
      },
      {
        "table": "auth_audit_log",
        "purpose": "Security audit trail",
        "key_columns": ["id", "user_id", "action", "resource", "details", "ip_address", "created_at"]
      },
      {
        "table": "auth_verification_codes",
        "purpose": "Verification codes for security",
        "key_columns": ["id", "user_id", "code", "type", "expires_at", "used_at"]
      }
    ],
    
    "ai_system": [
      {
        "table": "ai_system_logs",
        "purpose": "AI system operation logs",
        "key_columns": ["id", "operation_type", "project_id", "data", "result", "created_at"]
      },
      {
        "table": "ai_system_metrics",
        "purpose": "AI performance metrics",
        "key_columns": ["id", "metric_type", "value", "metadata", "timestamp"]
      },
      {
        "table": "ai_system_decisions",
        "purpose": "AI automated decisions",
        "key_columns": ["id", "decision_type", "project_id", "decision_data", "confidence", "created_at"]
      },
      {
        "table": "ai_system_recommendations",
        "purpose": "AI recommendations for optimization",
        "key_columns": ["id", "recommendation_type", "priority", "data", "status", "executed_by", "created_at"]
      }
    ]
  },
  
  "foreign_key_relationships": [
    {
      "foreign_table": "notifications",
      "foreign_column": "created_by",
      "references": "users.id",
      "description": "Links notifications to their creators"
    },
    {
      "foreign_table": "notification_queue",
      "foreign_column": "notification_id", 
      "references": "notifications.id",
      "description": "Links queue entries to notifications"
    },
    {
      "foreign_table": "notification_read_states",
      "foreign_column": "notification_id",
      "references": "notifications.id", 
      "description": "Tracks read status per notification"
    },
    {
      "foreign_table": "worker_attendance",
      "foreign_column": "worker_id",
      "references": "workers.id",
      "description": "Links attendance to workers"
    },
    {
      "foreign_table": "worker_attendance", 
      "foreign_column": "project_id",
      "references": "projects.id",
      "description": "Links attendance to projects"
    },
    {
      "foreign_table": "material_purchases",
      "foreign_column": "project_id", 
      "references": "projects.id",
      "description": "Links purchases to projects"
    },
    {
      "foreign_table": "material_purchases",
      "foreign_column": "material_id",
      "references": "materials.id", 
      "description": "Links purchases to materials"
    },
    {
      "foreign_table": "auth_user_roles",
      "foreign_column": "user_id",
      "references": "users.id",
      "description": "Links users to their roles"
    },
    {
      "foreign_table": "auth_user_roles",
      "foreign_column": "role_id", 
      "references": "auth_roles.id",
      "description": "Links roles to users"
    },
    {
      "foreign_table": "ai_system_recommendations",
      "foreign_column": "executed_by",
      "references": "auth.users.id",
      "description": "Links AI recommendations to executing users"
    }
  ],
  
  "data_types_reference": {
    "uuid": "Unique identifiers (128-bit)",
    "varchar": "Variable length text",
    "text": "Long text fields",
    "integer": "Whole numbers",
    "serial": "Auto-incrementing integers", 
    "decimal(10,2)": "Precise financial numbers",
    "timestamp": "Date and time with timezone",
    "timestamptz": "Timestamp with timezone",
    "boolean": "True/false values",
    "jsonb": "Optimized JSON data",
    "inet": "IP addresses",
    "USER-DEFINED": "Custom enum types"
  },
  
  "security_features": {
    "encryption": {
      "passwords": "bcrypt with 12 salt rounds",
      "sessions": "JWT tokens with expiration",
      "api_keys": "Hashed storage only"
    },
    "audit_trail": {
      "user_actions": "Comprehensive logging",
      "data_changes": "Before/after tracking",
      "ip_tracking": "All operations logged"
    },
    "access_control": {
      "rbac": "Role-based access control",
      "abac": "Attribute-based access control", 
      "mfa": "Multi-factor authentication"
    }
  },
  
  "performance_optimizations": {
    "indexes": [
      "notifications(type, priority)",
      "notification_queue(status, created_at)",
      "worker_attendance(project_id, date)",
      "fund_transfers(project_id, transfer_date)",
      "ai_recommendations(status, created_at)"
    ],
    "query_optimization": "Drizzle ORM with prepared statements",
    "connection_pooling": "Supabase automatic pooling"
  }
}